# GPT-Network-IDS-Project

## Disclaimer
This repository does not include the data on which the models were trained on and therefor were the base of the evaluation. The data in question can be found here: [Water Distribution Testbed](https://ieee-dataport.org/open-access/hardware-loop-water-distribution-testbed-wdt-dataset-cyber-physical-security-testing) 

## Getting started

### configs
This project works with configuration files. Some examples for such are located in config/. All key configurations for preprocessing and training are made here. The project name thereby defines the folder in which the processed data will be stored for further processing. For further information take a look at a config file. Note that some parameters are not yet fully implemented. Further are all paths in this project relative to the project root.

### preprocessing
encode sample data testing/data/split_100000_normal.pcap.gz by executing data/pcap2enc.py config/dev.py. This will create a meta.pkl, pkt_train.bin and pkt_val.bin for further training in the folder specified in the config/dev.py config file.

### training
executing the train.py with parameter config/dev.py will train a gpt model. You can choose to train either the forward or backward model by choosing the appropriate value for the flag -which_model (default value: forward)


## IDS
Calling the ids.py, will start an evaluation of the provided datasets in an ids like manner. Further settings can be adjusted by setting the appropriate parameters.
### Parameters
Every parameter can be overwritten by adding **--parameter_name=parameter_value** to the call of the script.

General settings (necessary):
- project
    - The folder in /out in which both pretrained models are saved
- replay_data
    - The pcap which should be evaluated

Model related (optional):
- number_pkts_to_read
    - Amount of packets to be fed into a model until it can start predicting
    - Default: 64 due to fixed embedding size
- temperature
    - Influences the randomness of the predictions. Values < 1 decrease randomness, values > 1 increse it.
    - Default: 0.8
- seed
    - Can be set for replication of evaluation results.
    - Default: 1337
- device
    - Specifies, on which device the executing should be run. Cuda is only available for supporting NVIDIA GPUs
    - Default: cuda
- compile
    - Optimizes the model before starting the evaluation. Requires atleast Pytorch 2.0
    - Default: True

IDS specifics (optional):
- verbose
    - Will give live evaluation feedback, by triggering an alarm upon noticing a malicious packet.
    - Default: True
- logging_interval
    - The interval in which periodic information about the ids progress is being displayed
    - Default: 100
- overview
    - After the file was analyzed, the script will return a plot of the gathered data, based on the attack meta data.
    - Default: True
- alarm_threshold
    - The threshold for the percentages of predicitions, in decimal representation. If the predicted value is lower or equal, the IDS will flag the packet as malicious.
    - Default: 0.0
- attack_meta_data
    - The path of the attack meta data file. Can be generated by attackparser.py. Needs to be in the IPAL format
- out_dir
    - If the overview or IPAL parameters are set, the created files will be saved in this folder

### How it works
The IDS will start at the beginning of the provided data file and iterate over it. Every packet will be evaluated by both GPT-models, if possible (will not be the case for the first and last few packets). The forward model will check the likelihood of the packet as a successor of the packet sequence. The backward model will check the opposite, how likely it is for the packet to be the predecessor of the packet sequence. Both cases will result in a percentage in range 0-100%. Added together, they will result in a combined percentage. If that value is equal or less then a predefined alarm threshold, the packet will be flagged as malicious.

### Output
If the parameter 'verbose' is set, everytime a packet is flagged as malicious, an Alarm will be triggered.

After the IDS has processed the entire provided file, and the parameter 'overview' is set, it will generate a plot containing the resulting percentages (scores) of every packet in the file. Every packet flagged by the IDS, will be marked with a red dot. 

If a file for the attack meta data was provided, the plot will contain the attack intervals as grey areas. Additionally, the some metrics will be computed, specifically true/false positives and true/false negatives.

Incase of the parameter 'ipal' being set, the ids will produce a ipal conform file, which can be evaluated by the tool IPAL Evaluate.
